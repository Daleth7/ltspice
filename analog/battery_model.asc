Version 4
SHEET 1 4380 680
WIRE 736 96 720 96
WIRE 832 96 816 96
WIRE 304 144 256 144
WIRE 480 144 304 144
WIRE 624 144 544 144
WIRE 720 144 720 96
WIRE 720 144 704 144
WIRE 832 144 832 96
WIRE 848 144 832 144
WIRE 256 160 256 144
WIRE 304 160 304 144
WIRE 480 160 480 144
WIRE 544 160 544 144
WIRE 720 192 720 144
WIRE 736 192 720 192
WIRE 832 192 832 144
WIRE 832 192 800 192
WIRE 256 256 256 240
WIRE 304 256 304 224
WIRE 304 256 256 256
WIRE 480 256 480 240
WIRE 480 256 304 256
WIRE 544 496 544 480
WIRE 688 496 544 496
WIRE 848 496 768 496
FLAG 304 144 soc
FLAG 928 144 bat+
IOPIN 928 144 BiDir
FLAG 848 496 bat-
IOPIN 848 496 BiDir
FLAG 544 144 ocv
FLAG 304 256 0
SYMBOL res 272 144 M0
SYMATTR InstName Rself-dischg
SYMATTR Value {rselfdischg}
SYMBOL cap 288 160 R0
SYMATTR InstName Capacity
SYMATTR Value {cap}
SYMBOL bi 480 160 M0
SYMATTR InstName B1
SYMATTR Value I=I(Vsns)
SYMBOL res 720 128 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value {res}
SYMBOL res 832 80 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value {rc_res}
SYMBOL cap 800 176 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C1
SYMATTR Value {rc_cap}
SYMATTR SpiceLine Rser=1m
SYMBOL bv 544 144 R0
WINDOW 3 24 96 Invisible 0
SYMATTR Value V={a7}*V(soc)**7+{a6}*V(soc)**6
SYMATTR InstName Bocv1
SYMBOL bv 544 224 R0
WINDOW 3 24 96 Invisible 0
SYMATTR Value V={a5}*V(soc)**5+{a4}*V(soc)**4+{a3}*V(soc)**3
SYMATTR InstName Bocv2
SYMBOL bv 544 304 R0
WINDOW 3 24 96 Invisible 0
SYMATTR Value V={a2}*V(soc)**2+{a1}*V(soc)+{a0}
SYMATTR InstName Bocv3
SYMBOL voltage 784 496 R90
WINDOW 0 -32 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Vsns
SYMATTR Value 0
SYMBOL voltage 544 384 R0
SYMATTR InstName Vnom
SYMATTR Value {vnom}
SYMBOL res 944 128 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 1m
TEXT 296 560 Left 1 !.param capacity=2 vmax=4.15 vmin=3.05 vnom=3.714 cap=capacity*3600
TEXT 104 320 Left 2 !.ic V(soc)={init}
TEXT 104 288 Left 2 !.param init=1 rselfdischg=100k
TEXT 224 584 Left 0 !.param a7=241.6718194 a6=-900.24881126 a5=1356.345194 a4=-1063.17415 a3=465.433188 a2=-112.8654597 a1=14.0102448 a0=-0.720454302
TEXT 504 80 Left 2 !.param res=8.2m
TEXT 672 256 Left 2 !.param rc_res=15.8m rc_cap=38k
