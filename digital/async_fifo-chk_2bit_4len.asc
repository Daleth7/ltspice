Version 4
SHEET 1 880 1244
WIRE -48 -144 -144 -144
WIRE -48 -48 -48 -144
WIRE -32 -48 -48 -48
WIRE -128 -16 -224 -16
WIRE -32 -16 -128 -16
WIRE -1200 48 -1232 48
WIRE -1168 48 -1200 48
WIRE -1040 48 -1072 48
WIRE -1008 48 -1040 48
WIRE -800 48 -912 48
WIRE -768 48 -800 48
WIRE -128 48 -224 48
WIRE -32 48 -128 48
WIRE -656 64 -704 64
WIRE -768 80 -784 80
WIRE -784 96 -784 80
WIRE -768 96 -784 96
WIRE -784 112 -784 96
WIRE -768 112 -784 112
WIRE -656 112 -656 64
WIRE -640 112 -656 112
WIRE -512 112 -544 112
WIRE -480 112 -512 112
WIRE -352 112 -416 112
WIRE -288 112 -352 112
WIRE -784 128 -784 112
WIRE -768 128 -784 128
WIRE -752 128 -752 112
WIRE -752 128 -768 128
WIRE -1200 160 -1232 160
WIRE -1168 160 -1200 160
WIRE -1040 160 -1072 160
WIRE -1008 160 -1040 160
WIRE -800 160 -912 160
WIRE -768 160 -800 160
WIRE -672 176 -704 176
WIRE -640 176 -672 176
WIRE -512 176 -544 176
WIRE -480 176 -512 176
WIRE -352 176 -416 176
WIRE -288 176 -352 176
WIRE -768 192 -784 192
WIRE -784 208 -784 192
WIRE -768 208 -784 208
WIRE -784 224 -784 208
WIRE -768 224 -784 224
WIRE -784 240 -784 224
WIRE -768 240 -784 240
WIRE -752 240 -752 224
WIRE -752 240 -768 240
WIRE -160 288 -176 288
WIRE -160 304 -160 288
WIRE -160 320 -176 320
WIRE -64 320 -96 320
WIRE -32 320 -64 320
WIRE -16 320 -32 320
WIRE 32 320 0 320
WIRE 128 320 32 320
WIRE -160 336 -176 336
WIRE 128 336 80 336
WIRE 224 336 192 336
WIRE 240 336 224 336
WIRE -1088 352 -1104 352
WIRE -176 352 -176 336
WIRE -160 352 -176 352
WIRE -32 352 -32 320
WIRE -16 352 -32 352
WIRE 32 352 0 352
WIRE 80 352 80 336
WIRE 80 352 32 352
WIRE 128 352 96 352
WIRE 224 352 224 336
WIRE -1088 368 -1104 368
WIRE -176 368 -176 352
WIRE -160 368 -176 368
WIRE 128 368 112 368
WIRE -1088 384 -1104 384
WIRE -800 384 -816 384
WIRE -176 384 -176 368
WIRE -160 384 -176 384
WIRE -128 384 -128 368
WIRE -128 384 -160 384
WIRE 112 384 112 368
WIRE 128 384 112 384
WIRE -1088 400 -1088 384
WIRE -1088 400 -1104 400
WIRE -800 400 -800 384
WIRE 112 400 112 384
WIRE 128 400 112 400
WIRE 144 400 144 384
WIRE 144 400 128 400
WIRE -1088 416 -1088 400
WIRE -1088 416 -1104 416
WIRE -800 416 -816 416
WIRE -704 416 -736 416
WIRE -672 416 -704 416
WIRE -656 416 -672 416
WIRE -608 416 -640 416
WIRE -512 416 -608 416
WIRE -160 416 -176 416
WIRE -1120 432 -1120 416
WIRE -1104 432 -1120 432
WIRE -1088 432 -1088 416
WIRE -1088 432 -1104 432
WIRE -800 432 -816 432
WIRE -512 432 -560 432
WIRE -160 432 -160 416
WIRE -816 448 -816 432
WIRE -800 448 -816 448
WIRE -672 448 -672 416
WIRE -656 448 -672 448
WIRE -608 448 -640 448
WIRE -560 448 -560 432
WIRE -560 448 -608 448
WIRE -512 448 -544 448
WIRE -160 448 -176 448
WIRE -80 448 -96 448
WIRE -816 464 -816 448
WIRE -800 464 -816 464
WIRE -512 464 -528 464
WIRE -160 464 -176 464
WIRE -816 480 -816 464
WIRE -800 480 -816 480
WIRE -768 480 -768 464
WIRE -768 480 -800 480
WIRE -528 480 -528 464
WIRE -512 480 -528 480
WIRE -176 480 -176 464
WIRE -160 480 -176 480
WIRE 96 480 96 352
WIRE 96 480 -80 480
WIRE -528 496 -528 480
WIRE -512 496 -528 496
WIRE -496 496 -496 480
WIRE -496 496 -512 496
WIRE -176 496 -176 480
WIRE -160 496 -176 496
WIRE -800 512 -816 512
WIRE -176 512 -176 496
WIRE -160 512 -176 512
WIRE -128 512 -128 496
WIRE -128 512 -160 512
WIRE -1088 528 -1104 528
WIRE -800 528 -800 512
WIRE -1088 544 -1104 544
WIRE -800 544 -816 544
WIRE -720 544 -736 544
WIRE -1088 560 -1104 560
WIRE -800 560 -816 560
WIRE -1088 576 -1088 560
WIRE -1088 576 -1104 576
WIRE -816 576 -816 560
WIRE -800 576 -816 576
WIRE -544 576 -544 448
WIRE -544 576 -720 576
WIRE -1088 592 -1088 576
WIRE -1088 592 -1104 592
WIRE -816 592 -816 576
WIRE -800 592 -816 592
WIRE -1120 608 -1120 592
WIRE -1104 608 -1120 608
WIRE -1088 608 -1088 592
WIRE -1088 608 -1104 608
WIRE -816 608 -816 592
WIRE -800 608 -816 608
WIRE -768 608 -768 592
WIRE -768 608 -800 608
WIRE -304 752 -304 736
WIRE -304 752 -336 752
WIRE -304 928 -304 912
WIRE -304 928 -336 928
FLAG -352 112 wbin[2:0]
FLAG -512 112 wclk
FLAG -448 128 0
FLAG -128 -16 wmemptr[1:0]
FLAG -352 176 rbin[2:0]
FLAG -512 176 rclk
FLAG -448 192 0
FLAG -128 48 rmemptr[1:0]
FLAG -1296 48 write
IOPIN -1296 48 In
FLAG -1296 160 read
IOPIN -1296 160 In
FLAG -336 -144 din[1:0]
IOPIN -336 -144 In
FLAG 192 16 dout[1:0]
IOPIN 192 16 Out
FLAG -704 96 0
FLAG -768 128 0
FLAG -704 208 0
FLAG -768 240 0
FLAG -576 320 rptr[2:0]
FLAG -576 352 sync_wptr[2:0]
FLAG -512 496 0
FLAG -800 480 0
FLAG -816 416 wptr[2:1]
FLAG -816 384 sync_rptr[2:1]
FLAG -720 448 0
FLAG -800 608 0
FLAG -816 544 wptr[0]
FLAG -816 512 sync_rptr[0]
FLAG -720 544 0
FLAG -704 416 _eq[2:1]
FLAG -608 416 _eq[2]
FLAG -608 448 _eq[1]
FLAG -1216 -96 wbin[2:0]
FLAG -1072 -96 $G_fifo_wptr
FLAG -1216 -64 rbin[2:0]
FLAG -1072 -64 $G_fifo_rptr
FLAG -1344 336 wptr[2:0]
FLAG -1168 336 sync_wptr[2:0]
FLAG -1344 512 rptr[2:0]
FLAG -1168 512 sync_rptr[2:0]
FLAG -1104 432 0
FLAG -1168 400 0
FLAG -1040 48 w2
FLAG -1088 544 w2
FLAG -1040 160 r2
FLAG -1104 608 0
FLAG -1168 576 0
FLAG -1088 368 r2
FLAG -800 48 wdly
FLAG -800 160 rdly
FLAG -672 176 rgate
FLAG -656 64 wgate
FLAG -240 -96 0
FLAG -48 -144 dlatch[1:0]
FLAG 64 224 rptr[2:0]
FLAG 64 256 wptr[2:0]
FLAG 192 224 empty
IOPIN 192 224 Out
FLAG 240 336 full
IOPIN 240 336 Out
FLAG 128 400 0
FLAG -160 384 0
FLAG -176 320 wptr[2:1]
FLAG -176 288 rptr[2:1]
FLAG -80 352 0
FLAG -160 512 0
FLAG -176 448 wptr[0]
FLAG -176 416 rptr[0]
FLAG -80 448 0
FLAG -64 320 _eqo[2:1]
FLAG 32 320 _eqo[2]
FLAG 32 352 _eqo[1]
FLAG -448 320 0
FLAG -448 432 0
FLAG -448 464 _sync_full
FLAG -768 64 _sync_full
FLAG -768 176 _sync_empty
FLAG -448 352 _sync_empty
FLAG 192 368 0
FLAG 224 432 0
FLAG -288 -16 wbin[1:0]
FLAG -288 48 rbin[1:0]
FLAG -224 112 wptr[2:0]
FLAG -224 176 rptr[2:0]
FLAG -32 16 wgate
FLAG -32 80 rgate
FLAG -336 -112 wdly
FLAG -1088 528 w1
FLAG -1088 352 r1
FLAG -1200 48 w1
FLAG -1200 160 r1
FLAG 192 576 ovalid
IOPIN 192 576 Out
FLAG 208 624 0
FLAG 112 672 0
FLAG 32 672 0
FLAG 112 528 0
FLAG -336 752 dlatch[1:0]
FLAG 192 832 _has[3:0]
IOPIN 192 832 Out
FLAG -336 928 dout[1:0]
FLAG -256 720 fifoin[3]
FLAG -256 688 fifoin[2]
FLAG -256 656 fifoin[1]
FLAG -256 624 fifoin[0]
FLAG -256 896 fifoout[3]
FLAG -256 864 fifoout[2]
FLAG -256 832 fifoout[1]
FLAG -256 800 fifoout[0]
FLAG 32 768 fifoin[3:0]
FLAG 32 864 wgate
FLAG 32 800 fifoout[3:0]
FLAG 192 256 _empty
FLAG 32 576 _empty
FLAG 32 624 r1
FLAG 32 896 ovalid
FLAG -752 -80 0
FLAG -672 -80 $G_fifo_len
FLAG 32 832 r2
BUSTAP -656 416 -640 416
BUSTAP -656 448 -640 448
BUSTAP -16 320 0 320
BUSTAP -16 352 0 352
SYMBOL fifo3-mem_2bit_4len 80 16 R0
SYMATTR InstName X1
SYMBOL delay -592 112 R0
WINDOW 39 -2 30 Bottom 0
WINDOW 0 66 30 Bottom 2
SYMATTR SpiceLine tdr=2n
SYMATTR InstName X2
SYMBOL delay -592 176 R0
WINDOW 39 -2 30 Bottom 0
WINDOW 0 66 30 Bottom 2
SYMATTR SpiceLine tdr=2n
SYMATTR InstName X5
SYMBOL Digital\\and -736 16 R0
SYMATTR InstName A1
SYMBOL Digital\\and -736 128 R0
SYMATTR InstName A2
SYMBOL Digital\\and -480 384 R0
SYMATTR InstName A3
SYMBOL Digital\\xor -752 368 R0
WINDOW 0 -8 111 Left 2
SYMATTR InstName A[1:0]
SYMBOL Digital\\xor -752 496 R0
SYMATTR InstName A5
SYMBOL eq-3bit -496 336 R0
SYMATTR InstName X10
SYMBOL dac-3bit-fast -1152 -96 R0
SYMATTR InstName X11
SYMBOL dac-3bit-fast -1152 -64 R0
WINDOW 0 7 41 Bottom 2
SYMATTR InstName X12
SYMBOL sync-2stage -1264 336 R0
SYMATTR InstName X13
SYMBOL sync-2stage -1264 512 R0
SYMATTR InstName X14
SYMBOL Digital\\or -1136 320 M0
WINDOW 0 15 101 Left 2
SYMATTR InstName A6
SYMBOL Digital\\or -1136 496 M0
WINDOW 0 15 101 Left 2
SYMATTR InstName A7
SYMBOL delay -1120 48 R0
WINDOW 39 -2 30 Bottom 0
WINDOW 0 -64 42 Bottom 2
SYMATTR SpiceLine tdr=2n
SYMATTR InstName X16
SYMBOL delay -960 48 R0
WINDOW 39 -2 30 Bottom 0
WINDOW 0 3 -15 Bottom 2
SYMATTR SpiceLine tdr=2n
SYMATTR InstName X17
SYMBOL delay -1120 160 R0
WINDOW 39 -2 30 Bottom 0
WINDOW 0 -64 42 Bottom 2
SYMATTR SpiceLine tdr=2n
SYMATTR InstName X19
SYMBOL delay -960 160 R0
WINDOW 39 -2 30 Bottom 0
WINDOW 0 4 -16 Bottom 2
SYMATTR SpiceLine tdr=2n
SYMATTR InstName X20
SYMBOL dbuf_2bit -240 -128 R0
SYMATTR InstName X23
SYMBOL up_3bitcounter -448 112 R0
WINDOW 0 22 -14 Bottom 2
SYMATTR InstName X4
SYMBOL up_3bitcounter -448 176 R0
WINDOW 0 26 -15 Bottom 2
SYMATTR InstName X7
SYMBOL Digital\\and 160 288 R0
SYMATTR InstName A4
SYMBOL Digital\\xor -112 272 R0
WINDOW 0 -8 111 Left 2
SYMATTR InstName A[11:10]
SYMBOL Digital\\xor -112 400 R0
SYMATTR InstName A9
SYMBOL eq-3bit 144 240 R0
SYMATTR InstName X24
SYMBOL res 208 336 R0
SYMATTR InstName R1
SYMATTR Value 100k
SYMBOL bin2gray_2bit -256 -16 R0
SYMATTR InstName X3
SYMBOL bin2gray_2bit -256 48 R0
SYMATTR InstName X6
SYMBOL bin2gray_3bit -256 112 R0
SYMATTR InstName X25
SYMBOL bin2gray_3bit -256 176 R0
SYMATTR InstName X26
SYMBOL oneshot -1264 48 R0
WINDOW 39 0 30 Bottom 0
SYMATTR SpiceLine ton=10n
SYMATTR InstName X8
SYMBOL oneshot -1264 160 R0
WINDOW 39 0 30 Bottom 0
SYMATTR SpiceLine ton=10n
SYMATTR InstName X9
SYMBOL Digital\\dflop 112 528 R0
WINDOW 3 35 166 Left 2
SYMATTR Value td=2n
SYMATTR InstName A8
SYMBOL decoder_2bit -304 672 R0
SYMATTR InstName X15
SYMBOL decoder_2bit -304 848 R0
SYMATTR InstName X18
SYMBOL fifo_has_reg 112 832 R0
SYMATTR InstName X[23:20]
SYMBOL bi -752 -80 R270
WINDOW 0 32 40 VTop 2
WINDOW 3 -32 40 Invisible 2
SYMATTR InstName B1
SYMATTR Value I=V($G_fifo_wptr,$G_fifo_rptr)+IF(V($G_fifo_wptr)<V($G_fifo_rptr),8,0)
SYMATTR Value2 Rpar=1
TEXT -520 224 Left 0 ;Use 2-bit gray code for memory access but 3-bit gray code for full/empty sync'ing.
